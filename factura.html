<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reliabuy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Colocar logo en la Pestaña -->
    <link rel="icon" href="./imagenes/logoNav.png" type="image/png">

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Font Awesome Icon -->
	<link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <!-- CSS de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- CSS-->
    <link rel="stylesheet" href="./css/styles.css">


</head>
<body>

        <header class="header">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <!-- Logo en la izquierda -->

        <!-- ***** Logo ***** -->
        <a class="logo"><img src="" alt=""></a>

        <!-- Botón de menú hamburguesa para pantallas pequeñas -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Contenido de la barra de navegación -->
        <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
        <!-- Menú central -->
        <ul class="navbar-nav">
            <li class="nav-item">
            <a class="nav-link me-4" href="index.html" class="btn btn-primary mt-4" id="volverInicio">Volver al inicio</a>
            </li>
            <li class="nav-item">
            <button class="nav-link me-6"" id="generatePDF">Imprimir Factura</button>
            </li>
            
        </ul>
        </div>
    </nav>
    </header>


    <div class="container mt-5">
        <h1 class="h3 mb-5">Factura de Compra</h1>
        <div id="invoiceDetails">
            <!-- Los detalles de la factura se cargarán aquí -->
        </div>
    </div>

    <script>
        document.getElementById('generatePDF').addEventListener('click', function () {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const factura = JSON.parse(localStorage.getItem('factura'));
            const provincia = JSON.parse(localStorage.getItem('provincia'));
            const canton = JSON.parse(localStorage.getItem('canton'));

            if (factura && provincia && canton) {
                let yPosition = 20;

                // Logo de la empresa
                const logo = new Image();
                logo.src = './imagenes/logoNav.png'; // Ruta del logo
                logo.onload = function () {
                    doc.addImage(logo, 'PNG', 20, yPosition, 40, 20);  // Insertar logo en la factura
                    yPosition += 25;

                    // Título de la factura
                    doc.setFontSize(18);
                    doc.setFont("helvetica", "bold");
                    doc.text('Factura de Compra - Reliabuy', 20, yPosition);
                    yPosition += 10;

                    // Línea de separación
                    doc.setLineWidth(0.5);
                    doc.line(10, yPosition, 200, yPosition);  // Línea horizontal
                    yPosition += 5;

                    // Información del cliente
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "normal");
                    doc.text(`Nombre: ${factura.nombre}`, 20, yPosition);
                    yPosition += 8;
                    doc.text(`Correo Electrónico: ${factura.correo}`, 20, yPosition);
                    yPosition += 8;
                    doc.text(`Provincia: ${provincia.nombre}`, 20, yPosition);
                    yPosition += 8;
                    doc.text(`Cantón: ${canton.nombre}`, 20, yPosition);
                    yPosition += 12;

                    // Detalles de la compra
                    doc.setFont("helvetica", "bold");
                    doc.text('Detalles de la Compra:', 20, yPosition);
                    yPosition += 8;
                    doc.setFont("helvetica", "normal");
                    doc.text(`Subtotal: ${factura.subtotal.toLocaleString()}`, 20, yPosition); 
                    yPosition += 8;
                    doc.text(`Envío: ${factura.envio.toLocaleString()}`, 20, yPosition); 
                    yPosition += 8;
                    doc.text(`Total: ${factura.total.toLocaleString()}`, 20, yPosition); 
                    yPosition += 12;

                    // Productos comprados
                    doc.setFont("helvetica", "bold");
                    doc.text('Productos comprados:', 20, yPosition);
                    yPosition += 8;
                    doc.setFont("helvetica", "normal");
                    factura.productos.forEach(producto => {
                        doc.text(`${producto.nombre} - ${producto.precio.toLocaleString()} x ${producto.cantidad}`, 20, yPosition); // Añadir símbolo de colones
                        yPosition += 8;
                    });

                    // Línea de separación
                    doc.setLineWidth(0.5);
                    doc.line(10, yPosition, 200, yPosition);  // Línea horizontal
                    yPosition += 10;

                    // Información de la empresa
                    doc.setFont("helvetica", "italic");
                    doc.text('Reliabuy - www.reliabuy.com', 20, yPosition);

                    // Guardar el PDF
                    doc.save('factura_reliabuy.pdf');
                };
            } else {
                alert('No se encontraron detalles de la factura.');
            }
        });
    </script>
    

    <script src="js/metodoPago.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
